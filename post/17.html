<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=referrer content="no-referrer-when-downgrade">
<title>从gcc静态链接开始的讨论，学了好几手 | Kxn's eXercise Notes</title>
<meta property="og:title" content="从gcc静态链接开始的讨论，学了好几手 - Kxn's eXercise Notes">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2005-12-06T03:01:59+08:00">
<meta property="article:modified_time" content="2005-12-06T03:01:59+08:00">
<meta name=Keywords content>
<meta name=description content="从gcc静态链接开始的讨论，学了好几手">
<meta name=author content="kxn">
<meta property="og:url" content="https://kxn.github.io/post/17.html">
<link rel="shortcut icon" href=/favicon.ico type=image/x-icon>
<link rel=stylesheet href=/css/normalize.css>
<link rel=stylesheet href=/css/style.css>
<script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<link rel=stylesheet href=/css/douban.css>
<link rel=stylesheet href=/css/other.css>
</head>
<body>
<header id=header class=clearfix>
<div class=container>
<div class=col-group>
<div class=site-name>
<a id=logo href=https://kxn.github.io>
Kxn's eXercise Notes
</a>
<p class=description>Knowledge Sharing</p>
</div>
<div>
<nav id=nav-menu class=clearfix>
<a class=current href=https://kxn.github.io>首页</a>
<a href=https://kxn.github.io/archives/ title=归档>归档</a>
<a href=https://kxn.github.io/about-me/ title="About Me">About Me</a>
</nav>
</div>
</div>
</div>
</header>
<div id=body>
<div class=container>
<div class=col-group>
<div class=col-8 id=main>
<div class=res-cons>
<article class=post>
<header>
<h1 class=post-title>从gcc静态链接开始的讨论，学了好几手</h1>
</header>
<date class="post-meta meta-date">
2005年12月6日
</date>
<div class=post-meta>
<span>|</span>
<span class=meta-category><a href=/categories/Coding>Coding</a></span>
<span class=meta-category><a href=/categories/Tech-Notes>Tech Notes</a></span>
</div>
<div class=post-meta>
<span id=busuanzi_container_page_pv>|<span id=busuanzi_value_page_pv></span><span>
阅读</span></span>
</div>
<div class=post-content>
<p>昨天夜里某 bbs 上进行了一场关于 gcc 链接库的讨论，结果最后转移到了 Windows 下面 VC8 msvcr80.dll 的话题。。</p>
<p>事情的起因是这样的：</p>
<p>我想对某程序静态链接 libstdc++ ，但是动态链接　 libc, 　因为这个程序用到了 dlopen , 而 dlopen 是无法静态链接的。于是我问如何在 configure.in 里面找到 libstdc++.a 的具体路径，好加在 LDADD 里面</p>
<p>首先是 westline 师弟给出的解决方案 gcc -print-file-name=libstdc++.a , man 了一下，原来 gcc 还提供了一坨类似的函数，用来把他知道的都告诉你。</p>
<p>接下来话题就变成了为啥需要静态链接 libstdc++ 了，我其实就是想避免 libstdc++.so.5 和 libstdc++.so.6 的问题<br>
但是这时侯伟大的 kirbyzhou 爷现身了</p>
<blockquote>
<p>发信人: kirbyzhou (世界太小 梦想太大), 信区:<br>
标 题: Re: 问个土问题<br>
发信站: (Mon Dec 5 23:36:11 2005), 转信</p>
<p>主要是 c++需要知道 class 的实现细节内容，主要是指对象的大小。<br>
不然 C++的.so 接口定下来也不是什么难事。</p>
<dl>
<dt>【 在 COMMAN (　) 的大作中提到: 】</dt>
<dd>【 在 Kittyboy (Oyahoe) 的大作中提到: 】</dd>
<dd>: &mldr;&mldr;</dd>
<dd>: configure 的时候定位出 libstdc++.a 的路径应该是可以的，makefile 里面有那个路径，<br>
就是 configure 出来那个 gcc 的 lib 吧。。</dd>
<dd>: 不过静态 libstdc++并且动态 libc 这个要求也特别了一点。。</dd>
<dd>这个是想尽量减少依赖性呀，FC2 上面是 libstdc++.so.5 , FC3 上面就是 libstdc++.s<br>
o.6 了，太变态了，libc 倒是从 redhat ?.? 的时候开始已经是 libc.so.6 了。RH 9 开<br>
始里面的名称也都是 GLIBC2.3 了</dd>
</dl>
</blockquote>
<p>接下来大家开始讨论 Windows 下面把　 MSVCR71.DLL 的符号都给 forward 到 MSVCRT.DLL ，以减少程序依赖性的问题。</p>
<p>kirby 爷还是一如既往的拍砖。</p>
<blockquote>
<p>发信人: kirbyzhou (世界太小 梦想太大), 信区:<br>
标 题: Re: 问个土问题<br>
发信站: (Tue Dec 6 00:11:24 2005), 转信</p>
<dl>
<dt>【 在 boost (我是一棵无聊) 的大作中提到: 】</dt>
<dd>什么意思？缺的那些 symbol？还是说名字一样过去也不去？<br>
1.缺 symbol，比如一些检查 stack 的内部小函数。<br>
2.bootstrap 不一样</dd>
<dd>
<p>【 在 COMMAN (　) 的大作中提到: 】</p>
</dd>
<dd>: 但是 MSVCRT.dll 基本可以肯定不能支持 MSVCR71 的那些函数吧。我严重怀疑 forwar<br>
d 过去了也是一调用就崩。</dd>
</dl>
</blockquote>
<blockquote>
<p>发信人: kirbyzhou (世界太小 梦想太大), 信区:<br>
标 题: Re: 问个土问题<br>
发信站: (Tue Dec 6 00:35:30 2005), 转信</p>
<dl>
<dt>1.exception/type*info 及其子类的 size 不兼容问题</dt>
<dt>2.swprintf 以及一系列和 wchar_t*有关的东西</dt>
<dt>3.*_set_buffer_overrun_handler 等一系列</dt>
<dt>【 在 COMMAN (　) 的大作中提到: 】</dt>
<dd>admire 爷，看来您已经研究过缺 symbol 的函数名了，给个列表吧。</dd>
<dd>【 在 kirbyzhou (世界太小 梦想太大) 的大作中提到: 】</dd>
<dd>: 1.缺 symbol，比如一些检查 stack 的内部小函数。</dd>
<dd>: 2.bootstrap 不一样</dd>
</dl>
</blockquote>
<p>然后下来开始关于 manifest 的讨论。起因是大家开始讨论 VC8 的 msvcr80.dll 的安装问题，kirby 说这个一定要带 manifest, 否则根本不能用。我觉得不是这样的，不过我还没有做试验证明</p>
<blockquote>
<p>发信人: COMMAN (　), 信区:<br>
标 题: Re: 问个土问题<br>
发信站: (Tue Dec 6 00:41:47 2005), 转信</p>
<p>嗯，manifest 是表明了你这个 dll 在什么样的 context 下面 load<br>
然后 xp 支持一组 activatectx 之类函数，程序可以调用设定要用什么 context.<br>
如果非常懒，可以给程序也写一个 manifest, 这样 xp 的 loader 会帮你做这个事情<br>
两者加一起就可以自动动态挂接编译者想要的 dll 版本了。不会造成 dll 版本冲突。<br>
assembly 同理。</p>
<p>所以我总觉得这个不是必须的，如果没有大不了 fallback 到 system32 下面去 load 嘛</p>
<dl>
<dt>【 在 boost (我是一棵无聊) 的大作中提到: 】</dt>
<dd>我土鳖地问一句，manifest 是不是就是包了一个依赖的 crt dll 的 assembly 名字，</dd>
<dd>用来在 winsxs 目录下找 dll？</dd>
<dd>【 在 COMMAN (　) 的大作中提到: 】</dd>
<dd>: 可能是，我刷个牙回来还没有拍出来，不过我还是觉得 manifest 不是必须的，跟 wins<br>
xs 下面那些冲突就冲突了，基本造成问题的可能性微乎其微，只要 microsoft 这个 dll<br>
的向下兼容性还能够保持就行。</dd>
</dl>
</blockquote>
<p>本来话题发展到这里，已经跑题很远了，但是 zeel 爷出现了，并且给出了这个话题开始的最标准答案<br>
为这个讨论划上了完美的句号。</p>
<blockquote>
<p>发信人: zeel (我爱我老婆), 信区:<br>
标 题: Re: 问个土问题<br>
发信站: (Tue Dec 6 00:25:03 2005), 转信</p>
<p>发信人: Valentin Nechayev &lt;netch @segfault.kiev.ua>, 信区: Unix<br>
标 题: Re: Linking with different static and dynamic library<br>
发信站: Dark side of coredump (Tue Mar 11 20:15:23 2003)<br>
转信站: SMTH!maily.cic.tsinghua.edu.cn!news.happynet.org!news.cn99.com!newsfeed<br>
出 处: news.lucky.net</p>
<blockquote>
<blockquote>
<blockquote>
<p>Kenji Chan wrote:</p>
</blockquote>
</blockquote>
</blockquote>
<p>KC> Here I&rsquo;ve got a &ldquo;program&rdquo; which links to two library lib_a and lib_b<br>
KC> when I use &ndash;static for g++, it links all library statically<br>
KC> But how can I do this:<br>
KC> program &ndash;> statically lib_a.a<br>
KC> also &ndash;> dynamically lib_b.so<br>
KC> What command should I type?</p>
<p>If your system uses GNU ld, you may try following:</p>
<p>gcc -o $prog $objs -Wl,-Bstatic -l_a -Wl,-Bdynamic -l_b -Wl,-Bdynamic</p>
<p>last -Wl,-Bdynamic is here to provide mode for system default libraries<br>
(libc, etc.)</p>
<p>(If linker isn&rsquo;t GNU ld, find details in linker manuals.)</p>
</blockquote>
</div>
<div class="post-meta meta-tags">
没有标签
</div>
</article>
</div>
<footer id=footer>
<div>
&copy; 2021 <a href=https://kxn.github.io>Kxn's eXercise Notes By kxn</a>
</div>
<br>
<div>
<div class=github-badge>
<a href=https://gohugo.io/ target=_black rel=nofollow><span class=badge-subject>Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
</div>
<div class=github-badge>
<a href=https://www.flysnow.org/ target=_black><span class=badge-subject>Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
</div>
<div class=github-badge>
<a href=https://github.com/flysnow-org/maupassant-hugo target=_black><span class=badge-subject>Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
</div>
</div>
</footer>
<script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:!0}}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<a id=rocket href=#top></a>
<script type=text/javascript src="/js/totop.js?v=0.0.0" async></script>
<script type=text/javascript src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async></script>
<script src=/js/douban.js></script>
</div>
<div id=secondary>
<section class=widget>
<form id=search action=https://kxn.github.io/search/ method=get accept-charset=utf-8 target=_blank _lpchecked=1>
<input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch value=https://kxn.github.io>
<button type=submit class="submit icon-search"></button>
</form>
</section>
<section class=widget>
<h3 class=widget-title>最近文章</h3>
<ul class=widget-list>
<li>
<a href=https://kxn.github.io/post/557.html title="MSI B550 暗黑版跑黑苹果">MSI B550 暗黑版跑黑苹果</a>
</li>
<li>
<a href=https://kxn.github.io/post/553.html title="最简单的打造一台能够 RenderDoc 的手机">最简单的打造一台能够 RenderDoc 的手机</a>
</li>
<li>
<a href=https://kxn.github.io/post/541.html title="编译 RenderDoc 的安卓 apk(带interceptor-lib)">编译 RenderDoc 的安卓 apk(带interceptor-lib)</a>
</li>
<li>
<a href=https://kxn.github.io/post/532.html title=Linux下解决同一硬盘因为连接设备不一样导致扇区大小不一致的问题>Linux下解决同一硬盘因为连接设备不一样导致扇区大小不一致的问题</a>
</li>
<li>
<a href=https://kxn.github.io/post/529.html title="RHEL/CentOS/OracleLinux 8  yum 能看到，安装却没有的情况">RHEL/CentOS/OracleLinux 8 yum 能看到，安装却没有的情况</a>
</li>
<li>
<a href=https://kxn.github.io/post/521.html title=让服务器响应整个网段中的请求>让服务器响应整个网段中的请求</a>
</li>
<li>
<a href=https://kxn.github.io/post/514.html title="不要买技嘉 X570 Gaming X 主板">不要买技嘉 X570 Gaming X 主板</a>
</li>
<li>
<a href=https://kxn.github.io/post/509.html title="Golang socket 里面奇怪的 pipe 使用">Golang socket 里面奇怪的 pipe 使用</a>
</li>
<li>
<a href=https://kxn.github.io/post/504.html title=用RenderDoc和安卓模拟器抓帧手游>用RenderDoc和安卓模拟器抓帧手游</a>
</li>
<li>
<a href=https://kxn.github.io/post/500.html title="解决 Mac 电脑原生 EFI 安装 Windows 启动很慢的问题">解决 Mac 电脑原生 EFI 安装 Windows 启动很慢的问题</a>
</li>
</ul>
</section>
<section class=widget>
<h3 class=widget-title><a href=/categories/>分类</a></h3>
<ul class=widget-list>
<li><a href=https://kxn.github.io/categories/Coding/>Coding (12)</a></li>
<li><a href=https://kxn.github.io/categories/Entertainment/>Entertainment (5)</a></li>
<li><a href=https://kxn.github.io/categories/Network/>Network (33)</a></li>
<li><a href=https://kxn.github.io/categories/Pictures/>Pictures (2)</a></li>
<li><a href=https://kxn.github.io/categories/Software/>Software (27)</a></li>
<li><a href=https://kxn.github.io/categories/Tech-Notes/>Tech Notes (174)</a></li>
<li><a href=https://kxn.github.io/categories/Uncategorized/>Uncategorized (30)</a></li>
</ul>
</section>
<section class=widget>
<h3 class=widget-title><a href=/tags/>标签</a></h3>
<div class=tagcloud>
<a href=https://kxn.github.io/tags/.xsession-errors/>.xsession-errors</a>
<a href=https://kxn.github.io/tags/139/>139</a>
<a href=https://kxn.github.io/tags/720/>720</a>
<a href=https://kxn.github.io/tags/CentOS/>CentOS</a>
<a href=https://kxn.github.io/tags/adsl/>adsl</a>
<a href=https://kxn.github.io/tags/aliedit/>aliedit</a>
<a href=https://kxn.github.io/tags/bad-design/>bad design</a>
<a href=https://kxn.github.io/tags/buggy/>buggy</a>
<a href=https://kxn.github.io/tags/chdk-a570-canon/>chdk a570 canon</a>
<a href=https://kxn.github.io/tags/cname/>cname</a>
<a href=https://kxn.github.io/tags/dns/>dns</a>
<a href=https://kxn.github.io/tags/error/>error</a>
<a href=https://kxn.github.io/tags/fail/>fail</a>
<a href=https://kxn.github.io/tags/filesort/>filesort</a>
<a href=https://kxn.github.io/tags/fragrance-hill/>fragrance hill</a>
<a href=https://kxn.github.io/tags/google-chrome/>google chrome</a>
<a href=https://kxn.github.io/tags/gps/>gps</a>
<a href=https://kxn.github.io/tags/gzip/>gzip</a>
<a href=https://kxn.github.io/tags/half-duplex/>half duplex</a>
<a href=https://kxn.github.io/tags/ipv6-isatap-fedora/>ipv6 isatap fedora</a>
<a href=https://kxn.github.io/tags/javascript/>javascript</a>
<a href=https://kxn.github.io/tags/jtag-debrick-dell-2300-%E6%97%A0%E7%BA%BF%E8%B7%AF%E7%94%B1%E5%99%A8-%E4%BF%AE%E5%A4%8D-openwrt/>jtag debrick dell 2300 无线路由器 修复 openwrt</a>
<a href=https://kxn.github.io/tags/mobile-trail-explorer/>mobile trail explorer</a>
<a href=https://kxn.github.io/tags/mysql/>mysql</a>
<a href=https://kxn.github.io/tags/mysql-replication/>mysql replication</a>
<a href=https://kxn.github.io/tags/optimize/>optimize</a>
<a href=https://kxn.github.io/tags/performance/>performance</a>
<a href=https://kxn.github.io/tags/pushmail/>pushmail</a>
<a href=https://kxn.github.io/tags/query-cache/>query cache</a>
<a href=https://kxn.github.io/tags/qwerty/>qwerty</a>
<a href=https://kxn.github.io/tags/remote-backup/>remote backup</a>
<a href=https://kxn.github.io/tags/shortcut/>shortcut</a>
<a href=https://kxn.github.io/tags/slow-machine/>slow machine</a>
<a href=https://kxn.github.io/tags/sony-ericsson-m600i/>sony ericsson m600i</a>
<a href=https://kxn.github.io/tags/ssl/>ssl</a>
<a href=https://kxn.github.io/tags/trackback/>trackback</a>
<a href=https://kxn.github.io/tags/ucweb-6.3/>ucweb 6.3</a>
<a href=https://kxn.github.io/tags/unstable/>unstable</a>
<a href=https://kxn.github.io/tags/wildcard/>wildcard</a>
<a href=https://kxn.github.io/tags/xp/>xp</a>
<a href=https://kxn.github.io/tags/%E4%B8%93%E4%B8%9A%E7%89%88/>专业版</a>
<a href=https://kxn.github.io/tags/%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/>安全问题</a>
<a href=https://kxn.github.io/tags/%E6%8B%9B%E8%A1%8C/>招行</a>
<a href=https://kxn.github.io/tags/%E6%96%90%E8%AE%AFN1/>斐讯N1</a>
<a href=https://kxn.github.io/tags/%E9%A9%B1%E5%8A%A8/>驱动</a>
</div>
</section>
<section class=widget>
<h3 class=widget-title>友情链接</h3>
<ul class=widget-list>
<li>
<a target=_blank href=https://blog.kangkang.net/ title=我的非技术blog>我的非技术blog</a>
</li>
</ul>
</section>
<section class=widget>
<h3 class=widget-title>其它</h3>
<ul class=widget-list>
<li><a href=https://kxn.github.io/index.xml>文章 RSS</a></li>
</ul>
</section>
</div>
</div>
</div>
</div>
</body>
</html>