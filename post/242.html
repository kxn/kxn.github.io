<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=referrer content="no-referrer-when-downgrade">
<title>V970 改大 /data | Kxn's eXercise Notes</title>
<meta property="og:title" content="V970 改大 /data - Kxn's eXercise Notes">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2012-09-03T15:10:11+08:00">
<meta property="article:modified_time" content="2012-09-03T15:10:11+08:00">
<meta name=Keywords content>
<meta name=description content="V970 改大 /data">
<meta name=author content="kxn">
<meta property="og:url" content="https://kxn.github.io/post/242.html">
<link rel="shortcut icon" href=/favicon.ico type=image/x-icon>
<link rel=stylesheet href=/css/normalize.css>
<link rel=stylesheet href=/css/style.css>
<script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<link rel=stylesheet href=/css/douban.css>
<link rel=stylesheet href=/css/other.css>
</head>
<body>
<header id=header class=clearfix>
<div class=container>
<div class=col-group>
<div class=site-name>
<a id=logo href=https://kxn.github.io>
Kxn's eXercise Notes
</a>
<p class=description>Knowledge Sharing</p>
</div>
<div>
<nav id=nav-menu class=clearfix>
<a class=current href=https://kxn.github.io>首页</a>
<a href=https://kxn.github.io/archives/ title=归档>归档</a>
<a href=https://kxn.github.io/about-me/ title="About Me">About Me</a>
</nav>
</div>
</div>
</div>
</header>
<div id=body>
<div class=container>
<div class=col-group>
<div class=col-8 id=main>
<div class=res-cons>
<article class=post>
<header>
<h1 class=post-title>V970 改大 /data</h1>
</header>
<date class="post-meta meta-date">
2012年9月3日
</date>
<div class=post-meta>
<span>|</span>
<span class=meta-category><a href=/categories/Uncategorized>Uncategorized</a></span>
</div>
<div class=post-meta>
<span id=busuanzi_container_page_pv>|<span id=busuanzi_value_page_pv></span><span>
阅读</span></span>
</div>
<div class=post-content>
<p>为了节省成本，比较新的 android 手机一般会内置 2G-4G flash, 然后将除去系统剩下的部分作为 /sdcard，这样就不用随手机还送一个鸡肋的 tf 卡了。然而国内厂家也明白国内的特殊需求，因此通常也会保留 tf 卡插槽。于是如果你真的插了一个 tf 卡，就会悲剧的挂载在 /sdcard2 /sdcard/extra 之类非标准路径，不能被很多软件利用。目前常见的千元 android 手机，比如 zte v970, 夏新 N820 等，都是这样。</p>
<p>最简单的解决方案是 root 以后，修改 /system/etc/vold.fstab, 将里面 /sdcard 和 tf 卡的路径倒过来，这样 /sdcard 就还指向 tf 卡。但是机身原有的 /sdcard 空间就跑到了非标准路径，只能用来放些 mp3 之类的，这部分空间通常有 1-2G，与此同时，手机的 /data 分区却还经常是小小的几百 M, 一不小心把几个大家伙装进去就满了。如果能把浪费的空间都给 /data 就堪称完美。内置 flash 的速度和稳定性都要比外置的 sd 卡有优势，可以用来运行经常要启动的应用，比如微博微信之类。</p>
<p>改手机分区大小也不算是什么新鲜事情，以前在只有 512M 或者 1G flash 的手机上，经常有人放出来调整 /system 分区的 rom。 但是 V970 等流行屌丝机大部分是 MTK 方案的，而 MTK 方案的资料少之又少，我自己尝试修改了刷写工具的分区描述文件，但是刷机以后似乎无效，启动以后原来的分区大小没有变化，网上搜了一下，搜到一些可能是从事 MTK android 开发的人的笔记，里面提到 MTK 方案改分区是修改代码里面一个 xls 文件，然后用 ptgen 工具来生成所有对应的 .h 和刷写用的分区描述文件。如果是这样的话，说明 MTK 平台的分区信息可能是硬编码在内核里面的。这样除非搞到内核源码能重编译，否则就没啥搞头了（网上唯一找到的 MTK android 改分区的 ROM 是 HD7 的，但是其用到的 MT6573 网上有泄露出来的源代码，因此不知道作者是不是使用那些代码编译了一个新内核出来)</p>
<p>不过我们还有退而求其次的方案，那就是干脆把 /data 和原来 /sdcard 的空间也给调换过来算了。这样就只浪费原来 /data 的几百兆。和调换内外卡的情况不同的是，/data 是在 boot.img 启动的时候就挂载了，因此要调换这个，光 root phone 是不行的，还得修改 boot.img 里面的启动脚本才行。基本思路就是先解包，然后修改，最后重新打成 boot.img 刷进手机即可。</p>
<p>解包 MTK boot.img 的工具和其他平台略有不同，请使用 <a href=https://github.com/bgcngm/mtk-tools>xda 上 bruno 的工具</a> 下载两个.pl 文件就可以了，然后找一个你平台可以用的 mkbootimg 过来。执行</p>
<blockquote>
<p>perl unpack-MT65xx.pl boot.img</p>
</blockquote>
<p>之后会生成 boot.img-kernel 文件和 boot.img-ramdisk 目录，目录下面就是所有启动时 ramdisk 里面的文件，在里面修改所有 .rc 中涉及 /data 分区的地方即可， V970 的可以用我做的 <a href=http://blog.kangkang.org/static/v970-initrd-diff>diff</a>, 下载来</p>
<blockquote>
<p>cd boot.img-ramdisk<br>
patch -p1 ../v970-initrd-diff<br>
cd ..</p>
</blockquote>
<p>即可<br>
最后重新打包</p>
<blockquote>
<p>perl repack-MT65xx.pl -boot boot.img-kernel boot.img-ramdisk boot1.img</p>
</blockquote>
<p>这样就得到了一个 boot1.img. 把这个 boot1.img 单独刷进手机即可。</p>
<p>刷完了以后不要急于启动，因为两个分区原来的内容是不一样的，以前 /data 是 ext3/ext4 格式，而 /sdcard 通常是 fat 格式，因此请同时刷个第三方 recovery, 然后直接启动进 recovery，用 adb 连进去格式化新的 /data, V970 是</p>
<blockquote>
<p>adb shell mke2fs /emmc@fat<br>
adb shell tune2fs -O extents,uninit_bg,dir_index /emmc@fat<br>
adb shell e2fsck -f /emmc@fat</p>
</blockquote>
<p>这里不用 recovery 的格式化功能是因为 recovery 对 /data 的位置理解可能不一样，有可能格式化了其他的分区。</p>
<p>之后重启手机即可。</p>
<p>最后鸣谢一下神族论坛的 shuaidi, 参考了他的改大 data 方案。不过他方案的问题是授人以鱼，直接丢给你一个改好的 boot.img，对于洁癖者来说说实在不能接受。这个 boot.img 还有个副作用是 adb shell 默认是 root，这个虽然方便，但是有点太不安全。而且出了新版本以后也没法刷。还是自己在官方 rom 的基础上根据原理来改比较保险一些。</p>
</div>
<div class="post-meta meta-tags">
没有标签
</div>
</article>
</div>
<footer id=footer>
<div>
&copy; 2021 <a href=https://kxn.github.io>Kxn's eXercise Notes By kxn</a>
</div>
<br>
<div>
<div class=github-badge>
<a href=https://gohugo.io/ target=_black rel=nofollow><span class=badge-subject>Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
</div>
<div class=github-badge>
<a href=https://www.flysnow.org/ target=_black><span class=badge-subject>Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
</div>
<div class=github-badge>
<a href=https://github.com/flysnow-org/maupassant-hugo target=_black><span class=badge-subject>Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
</div>
</div>
</footer>
<script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:!0}}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<a id=rocket href=#top></a>
<script type=text/javascript src="/js/totop.js?v=0.0.0" async></script>
<script type=text/javascript src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async></script>
<script src=/js/douban.js></script>
</div>
<div id=secondary>
<section class=widget>
<form id=search action=https://kxn.github.io/search/ method=get accept-charset=utf-8 target=_blank _lpchecked=1>
<input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch value=https://kxn.github.io>
<button type=submit class="submit icon-search"></button>
</form>
</section>
<section class=widget>
<h3 class=widget-title>最近文章</h3>
<ul class=widget-list>
<li>
<a href=https://kxn.github.io/post/557.html title="MSI B550 暗黑版跑黑苹果">MSI B550 暗黑版跑黑苹果</a>
</li>
<li>
<a href=https://kxn.github.io/post/553.html title="最简单的打造一台能够 RenderDoc 的手机">最简单的打造一台能够 RenderDoc 的手机</a>
</li>
<li>
<a href=https://kxn.github.io/post/541.html title="编译 RenderDoc 的安卓 apk(带interceptor-lib)">编译 RenderDoc 的安卓 apk(带interceptor-lib)</a>
</li>
<li>
<a href=https://kxn.github.io/post/532.html title=Linux下解决同一硬盘因为连接设备不一样导致扇区大小不一致的问题>Linux下解决同一硬盘因为连接设备不一样导致扇区大小不一致的问题</a>
</li>
<li>
<a href=https://kxn.github.io/post/529.html title="RHEL/CentOS/OracleLinux 8  yum 能看到，安装却没有的情况">RHEL/CentOS/OracleLinux 8 yum 能看到，安装却没有的情况</a>
</li>
<li>
<a href=https://kxn.github.io/post/521.html title=让服务器响应整个网段中的请求>让服务器响应整个网段中的请求</a>
</li>
<li>
<a href=https://kxn.github.io/post/514.html title="不要买技嘉 X570 Gaming X 主板">不要买技嘉 X570 Gaming X 主板</a>
</li>
<li>
<a href=https://kxn.github.io/post/509.html title="Golang socket 里面奇怪的 pipe 使用">Golang socket 里面奇怪的 pipe 使用</a>
</li>
<li>
<a href=https://kxn.github.io/post/504.html title=用RenderDoc和安卓模拟器抓帧手游>用RenderDoc和安卓模拟器抓帧手游</a>
</li>
<li>
<a href=https://kxn.github.io/post/500.html title="解决 Mac 电脑原生 EFI 安装 Windows 启动很慢的问题">解决 Mac 电脑原生 EFI 安装 Windows 启动很慢的问题</a>
</li>
</ul>
</section>
<section class=widget>
<h3 class=widget-title><a href=/categories/>分类</a></h3>
<ul class=widget-list>
<li><a href=https://kxn.github.io/categories/Coding/>Coding (12)</a></li>
<li><a href=https://kxn.github.io/categories/Entertainment/>Entertainment (5)</a></li>
<li><a href=https://kxn.github.io/categories/Network/>Network (33)</a></li>
<li><a href=https://kxn.github.io/categories/Pictures/>Pictures (2)</a></li>
<li><a href=https://kxn.github.io/categories/Software/>Software (27)</a></li>
<li><a href=https://kxn.github.io/categories/Tech-Notes/>Tech Notes (174)</a></li>
<li><a href=https://kxn.github.io/categories/Uncategorized/>Uncategorized (30)</a></li>
</ul>
</section>
<section class=widget>
<h3 class=widget-title><a href=/tags/>标签</a></h3>
<div class=tagcloud>
<a href=https://kxn.github.io/tags/.xsession-errors/>.xsession-errors</a>
<a href=https://kxn.github.io/tags/139/>139</a>
<a href=https://kxn.github.io/tags/720/>720</a>
<a href=https://kxn.github.io/tags/CentOS/>CentOS</a>
<a href=https://kxn.github.io/tags/adsl/>adsl</a>
<a href=https://kxn.github.io/tags/aliedit/>aliedit</a>
<a href=https://kxn.github.io/tags/bad-design/>bad design</a>
<a href=https://kxn.github.io/tags/buggy/>buggy</a>
<a href=https://kxn.github.io/tags/chdk-a570-canon/>chdk a570 canon</a>
<a href=https://kxn.github.io/tags/cname/>cname</a>
<a href=https://kxn.github.io/tags/dns/>dns</a>
<a href=https://kxn.github.io/tags/error/>error</a>
<a href=https://kxn.github.io/tags/fail/>fail</a>
<a href=https://kxn.github.io/tags/filesort/>filesort</a>
<a href=https://kxn.github.io/tags/fragrance-hill/>fragrance hill</a>
<a href=https://kxn.github.io/tags/google-chrome/>google chrome</a>
<a href=https://kxn.github.io/tags/gps/>gps</a>
<a href=https://kxn.github.io/tags/gzip/>gzip</a>
<a href=https://kxn.github.io/tags/half-duplex/>half duplex</a>
<a href=https://kxn.github.io/tags/ipv6-isatap-fedora/>ipv6 isatap fedora</a>
<a href=https://kxn.github.io/tags/javascript/>javascript</a>
<a href=https://kxn.github.io/tags/jtag-debrick-dell-2300-%E6%97%A0%E7%BA%BF%E8%B7%AF%E7%94%B1%E5%99%A8-%E4%BF%AE%E5%A4%8D-openwrt/>jtag debrick dell 2300 无线路由器 修复 openwrt</a>
<a href=https://kxn.github.io/tags/mobile-trail-explorer/>mobile trail explorer</a>
<a href=https://kxn.github.io/tags/mysql/>mysql</a>
<a href=https://kxn.github.io/tags/mysql-replication/>mysql replication</a>
<a href=https://kxn.github.io/tags/optimize/>optimize</a>
<a href=https://kxn.github.io/tags/performance/>performance</a>
<a href=https://kxn.github.io/tags/pushmail/>pushmail</a>
<a href=https://kxn.github.io/tags/query-cache/>query cache</a>
<a href=https://kxn.github.io/tags/qwerty/>qwerty</a>
<a href=https://kxn.github.io/tags/remote-backup/>remote backup</a>
<a href=https://kxn.github.io/tags/shortcut/>shortcut</a>
<a href=https://kxn.github.io/tags/slow-machine/>slow machine</a>
<a href=https://kxn.github.io/tags/sony-ericsson-m600i/>sony ericsson m600i</a>
<a href=https://kxn.github.io/tags/ssl/>ssl</a>
<a href=https://kxn.github.io/tags/trackback/>trackback</a>
<a href=https://kxn.github.io/tags/ucweb-6.3/>ucweb 6.3</a>
<a href=https://kxn.github.io/tags/unstable/>unstable</a>
<a href=https://kxn.github.io/tags/wildcard/>wildcard</a>
<a href=https://kxn.github.io/tags/xp/>xp</a>
<a href=https://kxn.github.io/tags/%E4%B8%93%E4%B8%9A%E7%89%88/>专业版</a>
<a href=https://kxn.github.io/tags/%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/>安全问题</a>
<a href=https://kxn.github.io/tags/%E6%8B%9B%E8%A1%8C/>招行</a>
<a href=https://kxn.github.io/tags/%E6%96%90%E8%AE%AFN1/>斐讯N1</a>
<a href=https://kxn.github.io/tags/%E9%A9%B1%E5%8A%A8/>驱动</a>
</div>
</section>
<section class=widget>
<h3 class=widget-title>友情链接</h3>
<ul class=widget-list>
<li>
<a target=_blank href=https://blog.kangkang.net/ title=我的非技术blog>我的非技术blog</a>
</li>
</ul>
</section>
<section class=widget>
<h3 class=widget-title>其它</h3>
<ul class=widget-list>
<li><a href=https://kxn.github.io/index.xml>文章 RSS</a></li>
</ul>
</section>
</div>
</div>
</div>
</div>
</body>
</html>